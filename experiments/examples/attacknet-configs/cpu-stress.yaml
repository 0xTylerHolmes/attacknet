enclave_name: example-chaos-experiment
enclave_namespace: kt-example-chaos-experiment
kurtosis_package_id: github.com/kurtosis-tech/ethereum-package
kurtosis_config:
  participants:
    - el_type: nethermind
      cl_type: prysm
      el_extra_labels: {"ethereum-package.partition": "partitionA"}
      cl_extra_labels: { "ethereum-package.partition": "partitionA" }
      vc_extra_labels: { "ethereum-package.partition": "partitionA" }
      count: 1
    - el_type: reth
      cl_type: lighthouse
      el_extra_labels: { "ethereum-package.partition": "partitionA" }
      cl_extra_labels: { "ethereum-package.partition": "partitionA" }
      vc_extra_labels: { "ethereum-package.partition": "partitionA" }
      count: 1
    - el_type: besu
      cl_type: lighthouse
      el_extra_labels: { "ethereum-package.partition": "partitionA" }
      cl_extra_labels: { "ethereum-package.partition": "partitionA" }
      vc_extra_labels: { "ethereum-package.partition": "partitionA" }
      count: 1
    - el_type: reth
      cl_type: prysm
      el_extra_labels: { "ethereum-package.partition": "partitionA" }
      cl_extra_labels: { "ethereum-package.partition": "partitionA" }
      vc_extra_labels: { "ethereum-package.partition": "partitionA" }
      count: 1
    - el_type: geth
      cl_type: prysm
      el_extra_labels: { "ethereum-package.partition": "partitionA" }
      cl_extra_labels: { "ethereum-package.partition": "partitionA" }
      vc_extra_labels: { "ethereum-package.partition": "partitionA" }
      count: 1
    - el_type: reth
      cl_type: teku
      el_extra_labels: { "ethereum-package.partition": "partitionA" }
      cl_extra_labels: { "ethereum-package.partition": "partitionA" }
      vc_extra_labels: { "ethereum-package.partition": "partitionA" }
      count: 1
    - el_type: reth
      cl_type: teku
      el_extra_labels: { "ethereum-package.partition": "partitionA" }
      cl_extra_labels: { "ethereum-package.partition": "partitionA" }
      vc_extra_labels: { "ethereum-package.partition": "partitionA" }
      count: 1
    - el_type: reth
      cl_type: lodestar
      el_extra_labels: { "ethereum-package.partition": "partitionB" }
      cl_extra_labels: { "ethereum-package.partition": "partitionB" }
      vc_extra_labels: { "ethereum-package.partition": "partitionB" }
      count: 1
    - el_type: nethermind
      cl_type: lodestar
      el_extra_labels: { "ethereum-package.partition": "partitionB" }
      cl_extra_labels: { "ethereum-package.partition": "partitionB" }
      vc_extra_labels: { "ethereum-package.partition": "partitionB" }
      count: 1
    - el_type: besu
      cl_type: nimbus
      el_extra_labels: { "ethereum-package.partition": "partitionB" }
      cl_extra_labels: { "ethereum-package.partition": "partitionB" }
      vc_extra_labels: { "ethereum-package.partition": "partitionB" }
      count: 1
    - el_type: reth
      cl_type: nimbus
      el_extra_labels: { "ethereum-package.partition": "partitionB" }
      cl_extra_labels: { "ethereum-package.partition": "partitionB" }
      vc_extra_labels: { "ethereum-package.partition": "partitionB" }
      count: 1
    - el_type: geth
      cl_type: lighthouse
      el_extra_labels: { "ethereum-package.partition": "partitionB" }
      cl_extra_labels: { "ethereum-package.partition": "partitionB" }
      vc_extra_labels: { "ethereum-package.partition": "partitionB" }
      count: 1
    - el_type: nethermind
      cl_type: prysm
      el_extra_labels: { "ethereum-package.partition": "partitionB" }
      cl_extra_labels: { "ethereum-package.partition": "partitionB" }
      vc_extra_labels: { "ethereum-package.partition": "partitionB" }
      count: 1
    - el_type: besu
      cl_type: teku
      el_extra_labels: { "ethereum-package.partition": "partitionB" }
      cl_extra_labels: { "ethereum-package.partition": "partitionB" }
      vc_extra_labels: { "ethereum-package.partition": "partitionB" }
      count: 1
  network_params:
    num_validator_keys_per_node: 16
  additional_services:
    - prometheus_grafana
    - dora
    - assertoor
    - tx_spammer
    - blob_spammer
    - beacon_metrics_gazer
    - el_forkmon
  parallel_keystore_generation: false
  persistent: false
  disable_peer_scoring: true
chaos_config:
  start_new_devnet: false
  chaos_delay: 30s
  # first example uses the extra-labels, second example uses the pod label TODO add second example
  tests:
  - testName: cpu-stress
    # This fault can be verified by installing a metrics server and running top. Note it can take up to 60s for the fault to start after injection.
    # wget https://raw.githubusercontent.com/pythianarora/total-practice/master/sample-kubernetes-code/metrics-server.yaml
    # kubectl create -f metrics-server.yaml
    # kubectl top pod el-1-geth-lighthouse
    health:
      enableChecks: true
      gracePeriod: 2m0s
    planSteps:
    - stepType: injectFault
      description: 'Inject cpu stress'
      chaosFaultSpec:
        kind: StressChaos
        apiVersion: chaos-mesh.org/v1alpha1
        spec:
          mode: all
          selector:
            labelSelectors:
              kurtosistech.com.custom/ethereum-package.partition: partitionB
          stressors:
            cpu:
              workers: 30 # number of threads that apply stress defined by `load`. workers * load may exceed 100.
              load: 100
          duration: 300s
    - stepType: waitForFaultCompletion
      description: wait for faults to terminate
